@model LHOfficeBgo.ViewModel.Sys.ManageConfigEntityVMs.ManageConfigEntityVM

<wt:form vm="@Model">
    <wt:row items-per-row="ItemsPerRowEnum.Two">
        <wt:textbox field="Entity.DataKey" disabled="true" />
        <wt:textbox field="Entity.IosDownLoadUrl" />
        <wt:textbox field="Entity.AndroidDownLoadUrl" />

        <div class="layui-row ">
            <div class="layui-col-md9">
                <div class="layui-form-item">
                    
                    <div class="layui-input-block">
                        <lable for="Entity.QrCodeUrl">二维码地址</lable>
                        <input type="text" name="Entity.QrCodeUrl" value="@Model.Entity.QrCodeUrl" placeholder="" class="layui-input" id="EntityImgs" lay-verify="required" lay-filter="Entity.Imgsfilter">
                    </div>
                </div>

            </div>

            <div class="layui-col-md1">
                <div class="layui-form-item">
                    <div class="layui-input-block" style="margin-left:0px">
                        <image id="EntityImgsDetail" src="@Model.Entity.QrCodeUrl" width="128" height="128" />
                    </div>
                </div>

            </div>
            <div class="layui-col-md2">
                <div class="layui-form-item">
                    <div class="layui-input-block" style="margin-left:0px">
                        <button id="EntityImgsUploadButton" name="Entity.ImgsUploadButton" class="layui-btn layui-btn-sm" type="button" lay-filter="ManageConfigEntityVM_Entity_Imgsbuttonfilter">选择文件</button>
                        <input class="layui-upload-file" type="file" accept="" name="file">
                    </div>
                </div>
            </div>
        </div>
    </wt:row>
    <wt:hidden field="Entity.ID" />
    <wt:row align="AlignEnum.Right">
        <wt:submitbutton />
        <wt:closebutton />
    </wt:row>
</wt:form>
<script>


    var Lh = {
        initUploadObj: function (id) {

            var index = 0;

            //普通图片上传
            var uploadInst = layui.upload.render({
                elem: '#' + id
                , url: '/_Framework/UploadImage?1=1&_DONOT_USE_CS=default&saveInDb=false'
                , size: 0
                , accept: 'file'
                , exts: 'jpg|jpeg|gif|bmp|png|tif'
                , before: function (obj) {
                    index = layui.layer.load(2);
                }
                , done: function (res) {
                    layui.layer.close(index);
                    if (res.Data.Id == '') {

                        layui.layer.msg('上传失败');
                    }
                    else {
                        var imgId = this.item[0].id.replace("EntityImgsUploadButton", "EntityImgsDetail");
                        var inputId = this.item[0].id.replace("EntityImgsUploadButton", "EntityImgs");
                        $("#" + inputId).val(res.Data.Url);
                        $("#" + imgId).attr("src", res.Data.Url);

                    }
                }
                , error: function () {
                    layui.layer.close(index);
                }
            });
        },
        init: function () {
          
            Lh.initUploadObj("EntityImgsUploadButton");
         }


    };

    Lh.init();
</script>
